# Script to add i18n messages to messages.json
# Adds logger and main script messages to all language sections

$messagesPath = Join-Path $PSScriptRoot "messages.json.backup"
$outputPath = Join-Path $PSScriptRoot "messages.json"

# Load existing messages
$messages = Get-Content -Path $messagesPath -Raw | ConvertFrom-Json

# Define new messages for each language
$newMessagesJa = @{
    "loggerLogRotated" = "ログファイルがローテーションされました。バックアップ作成: {0}"
    "loggerCleanupStarted" = "古いログファイルをクリーンアップ中（保持期間: {0}日）"
    "loggerCleanupCompleted" = "{0}個の古いログファイルを削除し、{1} MB のディスク容量を解放しました"
    "loggerNotarizationStarted" = "ログ公証化プロセスを開始しています..."
    "loggerNotarizationSuccess" = "ログが正常に公証化されました。証明書ID: {0}"
    "loggerNotarizationFailed" = "ログ公証化に失敗しました: {0}"
    "loggerNotarizationDisabled" = "ログ公証化は無効です"
    "mainLoadingConfig" = "設定を読み込んでいます..."
    "mainConfigLoaded" = "設定が正常に読み込まれました。"
    "mainConfigLoadFailed" = "設定の読み込みに失敗しました: {0}"
    "mainLoggerInitFailed" = "ロガーの初期化に失敗しました: {0}"
    "mainStarted" = "Focus Game Deck を開始しました（マルチプラットフォーム）"
    "mainGameId" = "ゲームID: {0}"
    "mainPlatformManagerInit" = "プラットフォームマネージャーを初期化しました"
    "mainAvailablePlatforms" = "利用可能なプラットフォーム: {0}"
    "mainAutoDetectedPath" = "{0} のパスを自動検出しました: {1}"
    "mainPlatformInitFailed" = "プラットフォームマネージャーの初期化に失敗しました: {0}"
    "mainValidatingConfig" = "設定を検証しています..."
    "mainConfigValidationFailed" = "設定の検証に失敗しました"
    "mainConfigValidationPassed" = "設定の検証に成功しました"
    "mainGameNotFound" = "エラー: ゲームID '{0}' が設定に見つかりません。"
    "mainAvailableGameIds" = "利用可能なゲームID: {0}"
    "mainPlatformNotAvailable" = "プラットフォーム '{0}' はゲーム '{1}' で利用できません"
    "mainGameConfigLoaded" = "ゲーム設定を読み込みました: {0}（プラットフォーム: {1}）"
    "mainOBSManagerInit" = "OBSマネージャーを初期化しました"
    "mainOBSConfigMissing" = "appsToManageにOBSが含まれていますが、OBS設定がありません"
    "mainCleanupInterrupted" = "ユーザーの中断（Ctrl+C）によりクリーンアップを開始しました。"
    "mainCleanupStarted" = "ゲームクリーンアップを開始しています"
    "mainCliborToggled" = "Cliborホットキーを切り替えました"
    "mainAppShutdownCompleted" = "アプリケーション終了シーケンスが完了しました"
    "mainOBSReplayBufferStopped" = "OBSリプレイバッファを停止しました"
    "mainCleanupCompleted" = "ゲームクリーンアップが完了しました"
    "mainTerminatedByUser" = "ユーザーによりアプリケーションが終了されました"
    "mainLaunchSequenceStarted" = "マルチプラットフォームゲーム起動シーケンス"
    "mainStartingOBS" = "OBSを起動しています..."
    "mainOBSStarted" = "OBSが正常に起動しました"
    "mainOBSReplayBufferStarted" = "OBSリプレイバッファを開始しました"
    "mainOBSStartFailed" = "OBSの起動に失敗しました"
    "mainStartingManagedApps" = "管理アプリケーションを起動しています..."
    "mainAppStartupCompleted" = "アプリケーション起動シーケンスが完了しました"
    "mainLaunchingGame" = "{0} 経由でゲームを起動しています..."
    "mainGameLaunchCommandSent" = "{0} へゲーム起動コマンドを送信しました: {1}"
    "mainGameLaunchFailed" = "{0} 経由でのゲーム起動に失敗しました: {1}"
    "mainWaitingForProcess" = "ゲームプロセスの起動を待っています..."
    "mainMonitoringProcess" = "プロセス {0} を監視中です。ゲームが終了するまでスクリプトは続行します。"
    "mainProcessDetected" = "ゲームプロセスを検出し、監視を開始しました: {0}"
    "mainProcessNotDetected" = "ゲームプロセス '{0}' がタイムアウト期間内に検出されませんでした"
    "mainGameExited" = "ゲームが終了しました: {0}"
    "mainGameProcessEnded" = "ゲームプロセスが終了しました: {0}"
    "mainSessionCompleted" = "Focus Game Deck セッションが正常に完了しました"
    "mainSessionCompletedMessage" = "Focus Game Deck セッションが完了しました。"
    "mainUnexpectedError" = "実行中に予期しないエラーが発生しました: {0}"
    "mainCleanupError" = "クリーンアップ中にエラーが発生しました: {0}"
    "mainFinalizingLog" = "セッションログを最終処理しています..."
    "mainLogNotarizedSuccess" = "[OK] ログが正常に公証化されました。証明書ID: {0}"
    "mainLogNotarizationInfo" = "この証明書は、必要に応じてログの整合性を検証するために使用できます。"
    "mainLogFinalized" = "ログが最終処理されました（公証化は無効または失敗）"
    "mainLogNotarizationFailed" = "ログの公証化に失敗しました: {0}"
    "mainFallbackWaitMessage" = "直接プロセス待機に失敗しました。フォールバックモード（3秒ごとにポーリング）で監視しています。管理者権限プロセスで発生する可能性があります。"
    "mainProcessExitedPolling" = "プロセスが終了しました（ポーリングで検出）: {0}（PID: {1}）"
}

$newMessagesEn = @{
    "loggerLogRotated" = "Log file rotated. Backup created: {0}"
    "loggerCleanupStarted" = "Cleaning up old log files (retention: {0} days)"
    "loggerCleanupCompleted" = "Cleaned up {0} old log file(s), freed {1} MB of disk space"
    "loggerNotarizationStarted" = "Starting log notarization process..."
    "loggerNotarizationSuccess" = "Log successfully notarized. Certificate ID: {0}"
    "loggerNotarizationFailed" = "Log notarization failed: {0}"
    "loggerNotarizationDisabled" = "Log notarization is disabled"
    "mainLoadingConfig" = "Loading configuration..."
    "mainConfigLoaded" = "Configuration loaded successfully."
    "mainConfigLoadFailed" = "Failed to load configuration: {0}"
    "mainLoggerInitFailed" = "Failed to initialize logger: {0}"
    "mainStarted" = "Focus Game Deck started (Multi-Platform)"
    "mainGameId" = "Game ID: {0}"
    "mainPlatformManagerInit" = "Platform manager initialized"
    "mainAvailablePlatforms" = "Available platforms: {0}"
    "mainAutoDetectedPath" = "Auto-detected {0} path: {1}"
    "mainPlatformInitFailed" = "Failed to initialize platform manager: {0}"
    "mainValidatingConfig" = "Validating configuration..."
    "mainConfigValidationFailed" = "Configuration validation failed"
    "mainConfigValidationPassed" = "Configuration validation passed"
    "mainGameNotFound" = "Error: Game ID '{0}' not found in configuration."
    "mainAvailableGameIds" = "Available game IDs: {0}"
    "mainPlatformNotAvailable" = "Platform '{0}' is not available or supported for game '{1}'"
    "mainGameConfigLoaded" = "Game configuration loaded: {0} (Platform: {1})"
    "mainOBSManagerInit" = "OBS manager initialized"
    "mainOBSConfigMissing" = "OBS is in appsToManage but OBS configuration is missing"
    "mainCleanupInterrupted" = "Cleanup initiated due to user interruption (Ctrl+C)."
    "mainCleanupStarted" = "Starting game cleanup"
    "mainCliborToggled" = "Clibor hotkeys toggled"
    "mainAppShutdownCompleted" = "Application shutdown sequence completed"
    "mainOBSReplayBufferStopped" = "OBS replay buffer stopped"
    "mainCleanupCompleted" = "Game cleanup completed"
    "mainTerminatedByUser" = "Application terminated by user"
    "mainLaunchSequenceStarted" = "Multi-Platform Game Launch Sequence"
    "mainStartingOBS" = "Starting OBS..."
    "mainOBSStarted" = "OBS started successfully"
    "mainOBSReplayBufferStarted" = "OBS replay buffer started"
    "mainOBSStartFailed" = "Failed to start OBS"
    "mainStartingManagedApps" = "Starting managed applications..."
    "mainAppStartupCompleted" = "Application startup sequence completed"
    "mainLaunchingGame" = "Launching game via {0}..."
    "mainGameLaunchCommandSent" = "Game launch command sent to {0}: {1}"
    "mainGameLaunchFailed" = "Failed to launch game via {0}: {1}"
    "mainWaitingForProcess" = "Waiting for game process to start..."
    "mainMonitoringProcess" = "Now monitoring process: {0}. The script will continue after the game exits."
    "mainProcessDetected" = "Game process detected and monitoring started: {0}"
    "mainProcessNotDetected" = "Game process '{0}' was not detected within timeout period"
    "mainGameExited" = "Game has exited: {0}"
    "mainGameProcessEnded" = "Game process ended: {0}"
    "mainSessionCompleted" = "Focus Game Deck session completed successfully"
    "mainSessionCompletedMessage" = "Focus Game Deck session completed."
    "mainUnexpectedError" = "Unexpected error during execution: {0}"
    "mainCleanupError" = "Error during cleanup: {0}"
    "mainFinalizingLog" = "Finalizing session log..."
    "mainLogNotarizedSuccess" = "[OK] Log successfully notarized. Certificate ID: {0}"
    "mainLogNotarizationInfo" = "This certificate can be used to verify log integrity if needed."
    "mainLogFinalized" = "Log finalized (notarization disabled or failed)"
    "mainLogNotarizationFailed" = "Failed to notarize log: {0}"
    "mainFallbackWaitMessage" = "Direct process wait failed. Monitoring process in fallback mode (polling every 3s). This can happen with admin-level processes."
    "mainProcessExitedPolling" = "Process has exited (detected by polling): {0} (PID: {1})"
}

$newMessagesZh = @{
    "loggerLogRotated" = "日志文件已轮换。创建备份: {0}"
    "loggerCleanupStarted" = "正在清理旧日志文件（保留期: {0}天）"
    "loggerCleanupCompleted" = "清理了{0}个旧日志文件，释放了{1} MB磁盘空间"
    "loggerNotarizationStarted" = "正在启动日志公证流程..."
    "loggerNotarizationSuccess" = "日志公证成功。证书ID: {0}"
    "loggerNotarizationFailed" = "日志公证失败: {0}"
    "loggerNotarizationDisabled" = "日志公证已禁用"
    "mainLoadingConfig" = "正在加载配置..."
    "mainConfigLoaded" = "配置加载成功。"
    "mainConfigLoadFailed" = "加载配置失败: {0}"
    "mainLoggerInitFailed" = "日志记录器初始化失败: {0}"
    "mainStarted" = "Focus Game Deck 已启动（多平台）"
    "mainGameId" = "游戏ID: {0}"
    "mainPlatformManagerInit" = "平台管理器已初始化"
    "mainAvailablePlatforms" = "可用平台: {0}"
    "mainAutoDetectedPath" = "自动检测到{0}路径: {1}"
    "mainPlatformInitFailed" = "平台管理器初始化失败: {0}"
    "mainValidatingConfig" = "正在验证配置..."
    "mainConfigValidationFailed" = "配置验证失败"
    "mainConfigValidationPassed" = "配置验证通过"
    "mainGameNotFound" = "错误: 配置中未找到游戏ID '{0}'。"
    "mainAvailableGameIds" = "可用游戏ID: {0}"
    "mainPlatformNotAvailable" = "平台 '{0}' 不可用或不支持游戏 '{1}'"
    "mainGameConfigLoaded" = "已加载游戏配置: {0}（平台: {1}）"
    "mainOBSManagerInit" = "OBS管理器已初始化"
    "mainOBSConfigMissing" = "appsToManage中包含OBS，但缺少OBS配置"
    "mainCleanupInterrupted" = "由于用户中断（Ctrl+C），已启动清理。"
    "mainCleanupStarted" = "正在启动游戏清理"
    "mainCliborToggled" = "Clibor热键已切换"
    "mainAppShutdownCompleted" = "应用程序关闭序列已完成"
    "mainOBSReplayBufferStopped" = "OBS重播缓冲已停止"
    "mainCleanupCompleted" = "游戏清理已完成"
    "mainTerminatedByUser" = "应用程序已被用户终止"
    "mainLaunchSequenceStarted" = "多平台游戏启动序列"
    "mainStartingOBS" = "正在启动OBS..."
    "mainOBSStarted" = "OBS启动成功"
    "mainOBSReplayBufferStarted" = "OBS重播缓冲已启动"
    "mainOBSStartFailed" = "OBS启动失败"
    "mainStartingManagedApps" = "正在启动受管应用..."
    "mainAppStartupCompleted" = "应用程序启动序列已完成"
    "mainLaunchingGame" = "正在通过{0}启动游戏..."
    "mainGameLaunchCommandSent" = "已向{0}发送游戏启动命令: {1}"
    "mainGameLaunchFailed" = "通过{0}启动游戏失败: {1}"
    "mainWaitingForProcess" = "正在等待游戏进程启动..."
    "mainMonitoringProcess" = "正在监视进程: {0}。脚本将在游戏退出后继续。"
    "mainProcessDetected" = "已检测到游戏进程并开始监视: {0}"
    "mainProcessNotDetected" = "超时期内未检测到游戏进程 '{0}'"
    "mainGameExited" = "游戏已退出: {0}"
    "mainGameProcessEnded" = "游戏进程已结束: {0}"
    "mainSessionCompleted" = "Focus Game Deck会话成功完成"
    "mainSessionCompletedMessage" = "Focus Game Deck会话已完成。"
    "mainUnexpectedError" = "执行期间发生意外错误: {0}"
    "mainCleanupError" = "清理期间发生错误: {0}"
    "mainFinalizingLog" = "正在完成会话日志..."
    "mainLogNotarizedSuccess" = "[确定] 日志公证成功。证书ID: {0}"
    "mainLogNotarizationInfo" = "如果需要，可以使用此证书验证日志完整性。"
    "mainLogFinalized" = "日志已完成（公证已禁用或失败）"
    "mainLogNotarizationFailed" = "日志公证失败: {0}"
    "mainFallbackWaitMessage" = "直接进程等待失败。以回退模式（每3秒轮询）监视进程。这可能发生在管理员级进程上。"
    "mainProcessExitedPolling" = "进程已退出（通过轮询检测）: {0}（PID: {1}）"
}

# Add new messages to each language section
foreach ($key in $newMessagesJa.Keys) {
    $messages.ja | Add-Member -NotePropertyName $key -NotePropertyValue $newMessagesJa[$key] -Force
}

foreach ($key in $newMessagesEn.Keys) {
    $messages.en | Add-Member -NotePropertyName $key -NotePropertyValue $newMessagesEn[$key] -Force
}

foreach ($key in $newMessagesZh.Keys) {
    $messages.'zh-CN' | Add-Member -NotePropertyName $key -NotePropertyValue $newMessagesZh[$key] -Force
}

# Save updated messages
$messages | ConvertTo-Json -Depth 10 | Set-Content -Path $outputPath -Encoding UTF8

Write-Host "Successfully added i18n messages to all language sections"
Write-Host "Output file: $outputPath"
